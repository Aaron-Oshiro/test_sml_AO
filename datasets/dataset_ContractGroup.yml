unique_name: dataset_ContractGroup
object_type: dataset
label: ContractGroup
columns:
  - name: Contract Group
    data_type: string
  - name: Participant 2
    data_type: string
    sql: 'null /*ContractGroup[Participant 1] TODO: Replace with valid SQL*/'
  - name: Top Contract Flag
    data_type: string
  - name: Performance Obligation Flag
    data_type: string
  - name: Participant 1
    data_type: string
  - name: countrows1
    data_type: int
    sql: '1'
connection_id: master
sql: >-
  select cg.[Contract Group], cg.[Top Contract Flag], cg.[Performance Obligation
  Flag] , string_agg(cg.GPLoc, ';') within group (order by cg.GPLoc)
  [Participant 1] from ( -- projects with contract groups SELECT DISTINCT 'CG-'
  + right(('000000' + ContractGroups.GROUP_NAME),6) [Contract Group] ,
  ISNULL(ContractGroups.TOP_CONTRACT_FLAG, 'N') [Top Contract Flag] ,
  ISNULL(ContractGroups.POB_FLAG, 'N') [Performance Obligation Flag] ,
  coalesce(TopTasks.[Top Task Owning Global Practice] + '.' + TopTasks.[Top Task
  Owning Office Location], Projects.[Project Owning Global Practice] + '.' +
  Projects.[Project Owning Office Location]) GPLoc FROM (select * from
  AnalyticsSource.dbo.ContractGroups union all select * from
  AnalyticsSource.east.ContractGroups) ContractGroups inner join (select
  ProjectID, [Project Owning Global Practice], [Project Owning Office Location]
  from Model_Common.dbo.Projects_West_lite where [Project Direct Flag] = 'Y' AND
  [Project Status] <> 'PERMANENTLY CLOSED' union all select ProjectID, [Project
  Owning Global Practice], [Project Owning Office Location] from
  Model_Common.dbo.Projects_East_lite where [Project Direct Flag] = 'Y' AND
  [Project Status] <> 'PERMANENTLY CLOSED') Projects on Projects.ProjectID =
  ContractGroups.PROJECT_ID left JOIN (select ProjectID, TopTaskId, [Top Task
  Owning Global Practice], [Top Task Owning Office Location] from
  Model_Common.dbo.Top_Tasks_West_lite union all select ProjectID, TopTaskId,
  [Top Task Owning Global Practice], [Top Task Owning Office Location] from
  Model_Common.dbo.Top_Tasks_East_lite) TopTasks ON ContractGroups.PROJECT_ID =
  TopTasks.ProjectID AND Projects.ProjectID >= 232700 ) cg group by cg.[Contract
  Group], cg.[Top Contract Flag], cg.[Performance Obligation Flag] UNION ALL --
  projects without contract groups select cg.[Contract Group], cg.[Top Contract
  Flag], cg.[Performance Obligation Flag] , string_agg(cg.GPLoc, ';') within
  group (order by cg.GPLoc) [Participant 1] from ( SELECT DISTINCT 'PR-' +
  right(('000000' + Projects.[Project Number]),6) [Contract Group] ,'N' [Top
  Contract Flag] ,'N' [Performance Obligation Flag] , coalesce(TopTasks.[Top
  Task Owning Global Practice] + '.' + TopTasks.[Top Task Owning Office
  Location], Projects.[Project Owning Global Practice] + '.' + Projects.[Project
  Owning Office Location]) GPLoc FROM (select ProjectID, [Project Number],
  [Project Owning Global Practice], [Project Owning Office Location], [Contract
  Group] from Model_Common.dbo.Projects_West_lite where [Project Direct Flag] =
  'Y' AND [Project Status] <> 'PERMANENTLY CLOSED' union all select ProjectID,
  [Project Number], [Project Owning Global Practice], [Project Owning Office
  Location], [Contract Group] from Model_Common.dbo.Projects_East_lite where
  [Project Direct Flag] = 'Y' AND [Project Status] <> 'PERMANENTLY CLOSED')
  Projects left JOIN (select ProjectID, TopTaskId, [Top Task Owning Global
  Practice], [Top Task Owning Office Location] from
  Model_Common.dbo.Top_Tasks_West_lite union all select ProjectID, TopTaskId,
  [Top Task Owning Global Practice], [Top Task Owning Office Location] from
  Model_Common.dbo.Top_Tasks_East_lite) TopTasks ON Projects.ProjectID =
  TopTasks.ProjectID AND Projects.ProjectID >= 232700 WHERE Projects.[Contract
  Group] is null ) cg group by cg.[Contract Group], cg.[Top Contract Flag],
  cg.[Performance Obligation Flag]
